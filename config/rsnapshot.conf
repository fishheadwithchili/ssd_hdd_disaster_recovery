# ============================================================================
# RSNAPSHOT CONFIGURATION - AI Infrastructure Edition
# 重要: 参数之间必须用 [TAB] 键分隔，不能用空格！
# ============================================================================

config_version	1.2

# ----------------------------------------------------------------------------
# 快照根目录
# ----------------------------------------------------------------------------
snapshot_root	/mnt/backup_hdd/snapshots/

# 如果分区未挂载，禁止创建根目录（防止写到系统盘）
no_create_root	1

# ----------------------------------------------------------------------------
# 外部命令
# ----------------------------------------------------------------------------
cmd_cp		/bin/cp
cmd_rm		/bin/rm
cmd_rsync	/usr/bin/rsync
cmd_logger	/usr/bin/logger
cmd_du		/usr/bin/du

# ----------------------------------------------------------------------------
# 快照保留策略（针对AI场景优化 - 节省空间）
# ----------------------------------------------------------------------------
retain	hourly	6      # 最近6小时
retain	daily	7      # 最近7天
retain	weekly	4      # 最近4周
retain	monthly	3      # 最近3个月（不是12！节省75%空间）

# ----------------------------------------------------------------------------
# 日志与调试
# ----------------------------------------------------------------------------
verbose		3
loglevel	3
logfile		/var/log/rsnapshot.log
lockfile	/var/run/rsnapshot.pid

# ----------------------------------------------------------------------------
# 性能优化
# ----------------------------------------------------------------------------
# 不跨越文件系统（防止备份到挂载的外部设备）
one_fs		1

# 使用硬链接（核心功能 - 增量备份的基础）
link_dest	1

# rsync参数优化（AI场景大文件优化）
# --sparse: 稀疏文件支持 (v2.0新增，防止VM镜像膨胀)
rsync_short_args	-aH
rsync_long_args	--delete --numeric-ids --relative --delete-excluded --stats --sparse

# ----------------------------------------------------------------------------
# 排除规则（使用外部文件 - 避免TAB键陷阱）
# ----------------------------------------------------------------------------
exclude_file	/etc/rsnapshot-exclude-ai.conf

# ----------------------------------------------------------------------------
# 备份点定义（只备份SSD关键数据）
# ----------------------------------------------------------------------------
# 格式: backup	<源目录>	<目标名称>/
# 注意: 不备份/home（用户明确说"备份了也没法用"）

backup	/mnt/nvme1_data1_ext4/hot-data/	ssd/
backup	/mnt/nvme1_data1_ext4/docker/	ssd/
backup	/mnt/nvme1_data1_ext4/services/	ssd/
backup	/mnt/nvme1_data1_ext4/projects/	ssd/
backup	/mnt/nvme1_data1_ext4/cache/	ssd/
backup	/mnt/nvme1_data1_ext4/downloads/	ssd/

# 系统配置（占用空间小但重要）
backup	/etc/			system/
backup	/root/			system/

# 可选: 如果你有关键脚本在/usr/local
backup	/usr/local/bin/		system/

# ----------------------------------------------------------------------------
# 备份后脚本（可选 - 高级功能）
# ----------------------------------------------------------------------------
# backup_script	/usr/local/bin/backup-mysql.sh	unused1
# backup_script	/usr/local/bin/verify-backup.sh	unused2
